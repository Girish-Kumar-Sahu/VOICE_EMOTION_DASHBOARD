<!DOCTYPE html>
<html>
<head>
    <title>Voice Emotion Dashboard</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body{
            font-family: Arial, sans-serif;
            background:#eef2f7;
            text-align:center;
        }

        h1{
            margin-top:20px;
        }

        .card{
            background:white;
            padding:25px;
            margin:20px auto;
            width:70%;
            border-radius:12px;
            box-shadow:0px 4px 15px rgba(0,0,0,0.1);
        }

        .upload-note{
            color:#d9534f;
            font-weight:bold;
            margin-top:10px;
        }

        .positive{
            color:#1b9e3e;
            font-weight:bold;
            font-size:22px;
        }

        .negative{
            color:#d7263d;
            font-weight:bold;
            font-size:22px;
        }

        button{
            background:#007bff;
            color:white;
            border:none;
            padding:10px 20px;
            border-radius:6px;
            cursor:pointer;
        }

        button:hover{
            background:#0056b3;
        }

        button:disabled{
            background:#ccc;
            cursor:not-allowed;
        }

        /* Loading Spinner Styles */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            font-size: 18px;
            margin-top: 20px;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            margin: 20px auto;
            width: 70%;
            border: 1px solid #f5c6cb;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            margin: 20px auto;
            width: 70%;
            border: 1px solid #c3e6cb;
        }
    </style>
</head>
<body>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
    <div style="text-align:center;">
        <div class="spinner"></div>
        <div class="loading-text">Analyzing audio...<br><small>This may take up to 30 seconds</small></div>
    </div>
</div>

<h1>üéôÔ∏è Voice Emotion Monitoring Dashboard</h1>

<div class="card">
<form action="/analyze" method="POST" enctype="multipart/form-data" id="analyzeForm">
    <input type="file" name="audio" accept=".wav" required id="audioFile">
    <br><br>
    <button type="submit" id="submitBtn">Analyze Emotion</button>
</form>

<p class="upload-note">
‚ö†Ô∏è Please upload only PCM WAV (.wav) audio files for accurate processing.
</p>
</div>

{% if error %}
<div class="error-message">
    <strong>Error:</strong> {{ error }}
</div>
{% endif %}

{% if emotion %}
<div class="card">
    <h3>üìù Detected Text</h3>
    <p>{{ text }}</p>

    <h2 class="{{ emotion|lower }}">
        Emotion: {{ emotion }} (Confidence {{ score }})
    </h2>
</div>
{% endif %}

{% if history and history|length > 0 %}
<div class="card">
    <h3>üìä Emotion Timeline (Minute:Second)</h3>
    <canvas id="emotionChart"></canvas>
</div>

<script>

const labels = [
    {% for item in history %}
        "{{ item.time }}",
    {% endfor %}
];

const dataValues = [
    {% for item in history %}
        {{ item.value }},
    {% endfor %}
];

new Chart(document.getElementById("emotionChart"), {
    type: "line",
    data: {
        labels: labels,
        datasets: [{
            label: "Emotion Timeline (1 = Positive, -1 = Negative)",
            data: dataValues,
            borderWidth: 3,
            tension: 0.3,
            fill:false
        }]
    },
    options:{
        responsive:true,
        scales:{
            y:{
                min:-1,
                max:1,
                ticks:{
                    callback: function(value){
                        if(value == 1) return "Positive";
                        if(value == -1) return "Negative";
                        return "";
                    }
                }
            }
        }
    }
});

</script>
{% endif %}

</body>
</html>
